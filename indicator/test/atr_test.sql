SELECT * FROM tap_atr(14, 0, '2017-12-31'::DATE-30, '2017-12-31'::DATE);


SELECT close_date, round(atr::NUMERIC, 2) FROM tap_atr(5, 1, '2005-11-01'::DATE, '2005-11-21'::DATE);


-- Expected
-- date	high	low	close	atr
-- 2005-11-01	82.15	81.29	81.59
-- 2005-11-02	81.89	80.64	81.06
-- 2005-11-03	83.03	81.31	82.87
-- 2005-11-04	83.30	82.65	83.00
-- 2005-11-07	83.85	83.07	83.61	1.12
-- 2005-11-08	83.90	83.11	83.15	1.05
-- 2005-11-09	83.33	82.49	82.84	1.01
-- 2005-11-10	84.30	82.30	83.99	1.21
-- 2005-11-11	84.84	84.15	84.55	1.14
-- 2005-11-14	85.00	84.11	84.36	1.09
-- 2005-11-15	85.90	84.03	85.53	1.24
-- 2005-11-16	86.58	85.39	86.54	1.23
-- 2005-11-17	86.98	85.76	86.89	1.23
-- 2005-11-18	88.00	87.17	87.77	1.21
-- 2005-11-21	87.87	87.01	87.29	1.14